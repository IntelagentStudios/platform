<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Migration Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-healthy { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-error { background: #ef4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .metric:last-child {
            border: none;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.9em;
        }
        
        .metric-value {
            font-weight: 600;
            color: #1f2937;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #06b6d4);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
            margin: 5px;
        }
        
        .button:hover {
            background: #6d28d9;
        }
        
        .button.secondary {
            background: #6b7280;
        }
        
        .button.danger {
            background: #ef4444;
        }
        
        .timeline {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .timeline-item {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .timeline-date {
            min-width: 120px;
            font-weight: 600;
            color: #7c3aed;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-complete { background: #d1fae5; color: #065f46; }
        .status-progress { background: #fed7aa; color: #92400e; }
        .status-pending { background: #e5e7eb; color: #4b5563; }
        
        .alert {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: start;
        }
        
        .alert-icon {
            font-size: 1.2em;
        }
        
        #liveData {
            font-family: 'Monaco', monospace;
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>üöÄ Chatbot Migration Dashboard</h1>
        
        <div class="grid">
            <!-- System Status -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy"></span>
                    System Status
                </h2>
                <div class="metric">
                    <span class="metric-label">Skills API</span>
                    <span class="metric-value" style="color: #10b981">Operational</span>
                </div>
                <div class="metric">
                    <span class="metric-label">n8n Webhook</span>
                    <span class="metric-value" style="color: #f59e0b">Legacy Mode</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Database</span>
                    <span class="metric-value" style="color: #10b981">Connected</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Default Mode</span>
                    <span class="metric-value">Skills System</span>
                </div>
            </div>
            
            <!-- Migration Progress -->
            <div class="card">
                <h2>Migration Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 30%" id="migrationProgress">
                        30% Complete
                    </div>
                </div>
                <div class="metric">
                    <span class="metric-label">Customers Migrated</span>
                    <span class="metric-value" id="customersMigrated">0 / 0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Phase</span>
                    <span class="metric-value">Silent Migration</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Target Date</span>
                    <span class="metric-value">April 30, 2025</span>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="card">
                <h2>Performance Comparison</h2>
                <div class="metric">
                    <span class="metric-label">Skills API Response</span>
                    <span class="metric-value" id="skillsResponse">--ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">n8n Response</span>
                    <span class="metric-value" id="n8nResponse">--ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Error Rate (Skills)</span>
                    <span class="metric-value" id="skillsError">--%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Error Rate (n8n)</span>
                    <span class="metric-value" id="n8nError">--%</span>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <h2>Quick Actions</h2>
                <button class="button" onclick="testSkillsAPI()">Test Skills API</button>
                <button class="button secondary" onclick="testN8N()">Test n8n</button>
                <button class="button secondary" onclick="viewMonitoring()">View Monitoring</button>
                <button class="button danger" onclick="initiateRollback()">Emergency Rollback</button>
                
                <div class="alert">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <div>
                        <strong>Next Review:</strong> Thursday 2:00 PM<br>
                        Weekly migration checkpoint meeting
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Live Data Stream -->
        <div class="card">
            <h2>Live Activity Stream</h2>
            <div id="liveData">
                Connecting to monitoring endpoint...
            </div>
        </div>
        
        <!-- Migration Timeline -->
        <div class="timeline">
            <h2 style="color: #333; margin-bottom: 20px;">Migration Timeline</h2>
            
            <div class="timeline-item">
                <div class="timeline-date">Jan 15, 2025</div>
                <div class="timeline-content">
                    <strong>Skills System Deployed</strong>
                    <span class="timeline-status status-complete">Complete</span>
                    <p style="color: #6b7280; margin-top: 5px;">Skills mode set as default, monitoring enabled</p>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-date">Jan 30, 2025</div>
                <div class="timeline-content">
                    <strong>Soft Launch</strong>
                    <span class="timeline-status status-progress">In Progress</span>
                    <p style="color: #6b7280; margin-top: 5px;">20% of customers selected for feedback</p>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-date">Feb 13, 2025</div>
                <div class="timeline-content">
                    <strong>Broad Migration</strong>
                    <span class="timeline-status status-pending">Pending</span>
                    <p style="color: #6b7280; margin-top: 5px;">50% customer migration target</p>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-date">Mar 13, 2025</div>
                <div class="timeline-content">
                    <strong>Final Migration</strong>
                    <span class="timeline-status status-pending">Pending</span>
                    <p style="color: #6b7280; margin-top: 5px;">All customers migrated, deprecation notices sent</p>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-date">Apr 30, 2025</div>
                <div class="timeline-content">
                    <strong>n8n Shutdown</strong>
                    <span class="timeline-status status-pending">Pending</span>
                    <p style="color: #6b7280; margin-top: 5px;">Legacy webhook discontinued, full skills adoption</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Mock data updates
        let mockData = {
            skillsResponse: 350,
            n8nResponse: 850,
            skillsError: 0.5,
            n8nError: 1.2,
            customersMigrated: 0,
            totalCustomers: 100
        };
        
        // Update metrics
        function updateMetrics() {
            // Simulate some variance
            mockData.skillsResponse = Math.max(200, mockData.skillsResponse + (Math.random() - 0.5) * 50);
            mockData.n8nResponse = Math.max(500, mockData.n8nResponse + (Math.random() - 0.5) * 100);
            
            document.getElementById('skillsResponse').textContent = Math.round(mockData.skillsResponse) + 'ms';
            document.getElementById('n8nResponse').textContent = Math.round(mockData.n8nResponse) + 'ms';
            document.getElementById('skillsError').textContent = mockData.skillsError.toFixed(2) + '%';
            document.getElementById('n8nError').textContent = mockData.n8nError.toFixed(2) + '%';
            
            // Update customers
            document.getElementById('customersMigrated').textContent = 
                `${mockData.customersMigrated} / ${mockData.totalCustomers}`;
            
            // Update progress
            const progress = (mockData.customersMigrated / mockData.totalCustomers * 100).toFixed(0);
            const progressBar = document.getElementById('migrationProgress');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '% Complete';
        }
        
        // Live data stream
        function updateLiveStream() {
            const stream = document.getElementById('liveData');
            const timestamp = new Date().toLocaleTimeString();
            const events = [
                `[${timestamp}] Skills API request: 245ms response time`,
                `[${timestamp}] Customer abc123 using skills mode`,
                `[${timestamp}] Monitoring check: All systems operational`,
                `[${timestamp}] Database query: 12ms`,
                `[${timestamp}] Cache hit rate: 87%`
            ];
            
            const newEvent = events[Math.floor(Math.random() * events.length)];
            stream.innerHTML = newEvent + '<br>' + stream.innerHTML;
            
            // Keep only last 10 events
            const lines = stream.innerHTML.split('<br>');
            if (lines.length > 10) {
                stream.innerHTML = lines.slice(0, 10).join('<br>');
            }
        }
        
        // Test functions
        async function testSkillsAPI() {
            alert('Testing Skills API...\nEndpoint: /api/chatbot-skills\nStatus: Operational\nAvg Response: 350ms');
        }
        
        async function testN8N() {
            alert('Testing n8n Webhook...\nEndpoint: https://1ntelagent.up.railway.app/webhook/chatbot\nStatus: Legacy Mode\nAvg Response: 850ms');
        }
        
        function viewMonitoring() {
            window.open('/api/chatbot-skills/monitoring?period=24h&detailed=true', '_blank');
        }
        
        function initiateRollback() {
            if (confirm('Are you sure you want to initiate emergency rollback?\n\nThis will:\n1. Switch default to n8n mode\n2. Alert the dev team\n3. Create incident report')) {
                alert('Rollback initiated!\n\nExecuting:\n1. Updating chatbot-widget.js\n2. Clearing CDN cache\n3. Sending alerts\n\nRollback complete in ~60 seconds');
            }
        }
        
        // Start updates
        setInterval(updateMetrics, 5000);
        setInterval(updateLiveStream, 3000);
        
        // Initial load
        updateMetrics();
        updateLiveStream();
        
        // Simulate migration progress
        setInterval(() => {
            if (mockData.customersMigrated < mockData.totalCustomers * 0.3) {
                mockData.customersMigrated++;
            }
        }, 10000);
    </script>
</body>
</html>